<!DOCTYPE html>
<html lang="en">

<%- include("extra/meta", {title: "Thread list!" }) %>


<body style="text-align: center;">
  <%- include("extra/navbar") %>

  <link rel="stylesheet" href="/css/thread.css" />
  <% if (user){ %>
    <script type="module" src="/js/thread.js"></script>
  <% }%>


  <h1 style="font-size: 35px;color: #4d18e6;" ><%= thread.title %></h1>
  <h3  >View count: <%= thread.views %></h1>

  <h2 style="display:inline;">By <a href="<%='/users/' + thread.author.id %>"> <%= thread.author.name %></a>
    <img class="circle" src="<%=thread.author.avatar %>">
  </h2>

  <% if (user && !thread.deleted){ %>

    <a onclick="delete_thread('<%= thread.id %>' )" value=style="display:inline;" >DELETE</a>
    <a onclick="edit_thread('<%= thread.id %>')" style="display:inline;" >EDIT</a>
  <% } else if (thread.deleted) { %>
    <h3 style="display:inline;">This thread has been deleted</h3>
    <a onclick="undelete_thread('<%= thread.id %>')" style="display:inline;" >UNDELETE</a>

  <% }; %>


        <hr>


        <div id="messages" value="<%= thread.id %>">
       
            <% messages.filter(Boolean).forEach(message=>{ %>

            <div class="message" id="message-<%= message.id %>">
    
              <h3 style="float:right;"><%= new Date(message.time).toLocaleString() %> </h3>
          
              <h2>
                <img class="circle" src="<%= message.author.avatar %>">
                  <a href="/users/<%=message.author.id %>"><%=message.author.name %></a>:
              </h2>
          
              <p><%= message.content%></p><br>
              <div id="message-delete-<%=message.id %>">
              
                <% if (!message.deleted){ %>
              
                <a onclick="delete_message('<%=message.id %>');">DELETE</a>
                <a onclick="edit_message('<%=message.id %>');">EDIT</a>
                <% }else{ %>
                  <h3 style="display:inline;">This message has been deleted</h3>
            <a onclick="undelete_message('<%=message.id %>');">UNDELETE</a>
                  <% } %>

              </div>
              <div style="float: right;">
                  <h3 id="count<%=message.id %>" style="display:inline;"><%=message.reactCount %></h3>
                  <a onclick="react('<%=message.id %>', 'like');">+ðŸ”¼</a>
                  <a onclick="react('<%=message.id %>', 'dislike');">-ðŸ”½</a>
              </div>
          </div>
                      <% }); %>

        </div>

        <hr>


        <form id="send">
          <textarea rows="4" cols="133" name="content"></textarea>
          <input name="threadID" type="hidden" value="<%= thread.id %>"></input>

          <br>
          <% if (user){ %>
            <button type="submit">Send!</button>
          <%} else {%>
            <button disabled>Login for send</button>
          <% }%>

        </form>

 
        <script>
          document.getElementById("message-<%= scroll %>").scrollIntoView();
        </script>

            <!-- BURAYA BÄ° Ä°LERÄ° BÄ°R GERÄ° SAYFA BUTONU GELMEZ MÄ° BE-->
</body>

</html>