<!DOCTYPE html>
<html lang="en">

<%- include("extra/meta", {title: member.name }) %>


<body>
  <link rel="stylesheet" href="/css/user.css" />

  <%- include("extra/navbar") %>

  <div class="content">
    <div class="box" style="justify-content:center;">
    <img style="width:100px;height:100px;border-radius:50%;" src="<%=member.avatar %>">
    </div>
    <div class="box">
      <h2 class="box-title">Name:</h2>
    <h2 class="box-title">
      <%= member.name %>
    </h2>

    </div>

    <div class="box">
      <h2 class="box-title">Created at:
      </h2>
      <h2 class="box-title">  
      <%= new Date(member.time).toLocaleString() %>
      </h2>
      </div>
    <div class="box">
      
      <h2 class="box-title">Is admin?
      </h2>
      <h2 class="box-title">
      <%= member.admin ? "Yes" : "No" %>
      </h2>
    </div>

      <div class="box">
        
      <h2 class="box-title"> Message:
      </h2>
        <h2 class="box-title">
          <%= counts.message %>
        </h2>
      </div>
    <div class="box">
      
      <h2 class="box-title"> Thread:
      </h2>
      <h2 class="box-title">
<%= counts.thread %>
      </h2>
    </div>

  <% if (user?.admin && !member.deleted) {%>
      <a class="btn-outline-primary" id="admin">Give admin permissions!</a>
      <a class="btn-outline-primary"  id="delete">Delete user!</a>
 
    <script type="module">

      import request from "../../js/request.js";
      document.addEventListener("click", async e => {
    if (e.target.id == "admin") {

          const response = await request("/api/users/<%= member.id %>/admin");

          if (response.admin)
            return alert("Making admin of " + response.name + " is success!");

        }else if (e.target.id == "delete") {

          const response = await request("/api/users/<%= member.id %>/delete");
 
          if (!response.deleted) return
          alert("User is deleted!");
          location.reload()

        }

      

      });


    </script>
  <% }; %>
  <% if (member.deleted) {%>
        <h1>This user has been deleted!</h1>
        <a onclick="undelete();" class="btn-primary"  >Undelete user! </a>
  
 
    
        <script type="module">
    
          import request from "../../js/request.js";
          window.undelete= async function undelete(params) {
            
            const response = await request("/api/users/<%= member.id %>/undelete");
     
            if (response.deleted) return;
              alert("User is undeleted successfully!");
              location.reload()
          }
        
    
    
        </script>
  <% }; %>

</div>
</body>

</html>
